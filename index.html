<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AVECTRUM ‚Äî Cr√©ditos</title>

  <style>
    :root{
      --bg:#07070a;
      --card:#0e0f14;
      --stroke:rgba(255,255,255,.10);
      --text:#e9eef6;
      --muted:rgba(255,255,255,.62);
      --red:#ff5757;
      --shadow: 0 14px 34px rgba(0,0,0,.55);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 420px at 18% -10%, rgba(255,87,87,.12), transparent 60%),
        radial-gradient(900px 420px at 82% 0%, rgba(255,87,87,.08), transparent 60%),
        linear-gradient(180deg, #050507, #07070a 55%, #050507);
      min-height:100vh;
      padding:26px 14px 60px;
    }
    .wrap{max-width:980px;margin:0 auto}

    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      margin-bottom:14px;
    }
    .brand{
      display:flex;align-items:center;gap:12px;
      font-weight:950;
      letter-spacing:.6px;
      font-size:18px;
    }
    .badge{
      font-size:11px;
      padding:6px 10px;
      border:1px solid rgba(255,87,87,.35);
      background:rgba(255,87,87,.10);
      border-radius:999px;
      color:rgba(255,255,255,.92);
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .btnGhost{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.03);
      color:var(--text);
      padding:10px 14px;
      border-radius:999px;
      cursor:pointer;
      transition:.2s;
      font-weight:900;
    }
    .btnGhost:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.22)}

    .hero{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      margin:10px 0 16px;
    }
    @media (max-width:860px){ .hero{grid-template-columns:1fr} }

    .card{
      background:rgba(255,255,255,.03);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      padding:18px;
      box-shadow: var(--shadow);
    }
    .title{
      font-size:26px;margin:0 0 8px;font-weight:1000;letter-spacing:.2px;
    }
    .subtitle{margin:0;color:var(--muted);font-size:14px;line-height:1.45}
    .miniRow{
      margin-top:12px;
      display:flex;gap:10px;flex-wrap:wrap;
    }
    .mini{
      font-size:12px;
      color:var(--muted);
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.25);
      padding:6px 10px;
      border-radius:999px;
    }
    .mini b{color:rgba(255,255,255,.92)}
    .mini .red{color:var(--red)}

    .stepsCard{
      background:rgba(0,0,0,.26);
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--radius);
      padding:16px;
    }

    .stepHeader{
      display:flex;align-items:flex-start;justify-content:space-between;gap:16px;flex-wrap:wrap;
      margin-bottom:10px;
    }
    .stepTitle small{
      color:rgba(255,255,255,.55);
      letter-spacing:.14em;text-transform:uppercase;font-size:11px;
    }
    .stepTitle b{display:block;font-size:22px;margin-top:4px}
    .stepTitle span{display:block;margin-top:4px;color:var(--muted);font-size:13px}

    .progress{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .dot{
      width:10px;height:10px;border-radius:999px;
      background:rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.14);
    }
    .dot.active{background:var(--red);border-color:rgba(255,87,87,.55)}
    .line{width:60px;height:2px;background:rgba(255,255,255,.16)}
    .line.active{background:rgba(255,87,87,.55)}
    .stepLabel{
      font-size:11px;color:rgba(255,255,255,.55);
      letter-spacing:.10em;text-transform:uppercase;
    }
    .stepLabel.active{color:rgba(255,255,255,.92)}

    .grid2{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width:860px){ .grid2{grid-template-columns:1fr} }

    .box{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.02);
      border-radius:16px;
      padding:14px;
    }
    .boxTitle{
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(255,255,255,.60);
      margin-bottom:8px;
    }

    /* ‚úÖ Seletor de pacotes */
    .selectWrap{
      margin-top:8px;
      display:grid;
      gap:10px;
    }
    .selectHint{
      font-size:12px;
      color:rgba(255,255,255,.55);
      line-height:1.4;
    }
    .packageDetails{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      border-radius:14px;
      padding:12px;
    }
    .packageDetails .k{
      font-size:12px;color:rgba(255,255,255,.62);
    }
    .packageDetails .v{
      margin-top:4px;
      font-weight:1000;
      font-size:14px;
      color:rgba(255,255,255,.92);
    }
    .packageDetails .price{
      margin-top:10px;
      font-weight:1100;
      font-size:18px;
      color:var(--red);
    }

    .inputs{
      display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px;
    }
    @media (max-width:560px){ .inputs{grid-template-columns:1fr} }
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
      font-size:16px; /* ‚úÖ ajuda no iOS (evita zoom e melhora select) */
    }
    select{ color-scheme: dark; }
    select option{
      background:#0e0f14;
      color:#e9eef6;
    }
    input::placeholder{color:rgba(255,255,255,.35)}
    input:focus, select:focus{border-color:rgba(255,87,87,.45)}

    .row{
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
      color:var(--muted);font-size:13px;
      margin-top:8px;
    }
    .row strong{color:rgba(255,255,255,.92)}
    .total{font-size:22px;font-weight:1000;color:var(--red)}

    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn{
      padding:12px 14px;
      border-radius:999px;
      border:1px solid rgba(255,87,87,.45);
      background:linear-gradient(180deg, rgba(255,87,87,.25), rgba(255,87,87,.12));
      color:rgba(255,255,255,.95);
      font-weight:1000;
      cursor:pointer;
      transition:.2s;
      min-width:220px;
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(255,87,87,.70)}
    .btn2{
      padding:12px 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.04);
      color:rgba(255,255,255,.90);
      font-weight:1000;
      cursor:pointer;
      transition:.2s;
      min-width:220px;
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
    }
    .btn2:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.22)}

    .pixBox{
      margin-top:10px;
      padding:12px;
      border-radius:14px;
      border:1px dashed rgba(255,87,87,.55);
      background:rgba(255,87,87,.08);
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
    }
    .pixKey{font-weight:1000;color:rgba(255,255,255,.92);word-break:break-all}
    .copyBtn{
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.25);
      color:rgba(255,255,255,.92);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:1000;
    }
    .copyBtn:hover{border-color:rgba(255,255,255,.26)}

    .warn{margin-top:10px;font-size:12px;color:rgba(255,255,255,.55)}
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:rgba(0,0,0,.72);
      border:1px solid rgba(255,255,255,.12);
      padding:10px 12px;border-radius:999px;
      color:rgba(255,255,255,.92);
      font-size:13px;
      display:none;
      z-index:50;
    }
    .bigMsg{
      font-size:14px;
      color:rgba(255,255,255,.80);
      line-height:1.5;
      margin:6px 0 0;
    }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      letter-spacing:.04em;
    }
  </style>
</head>

<body>
<div class="wrap">

  <div class="topbar">
    <div class="brand">
      AVECTRUM <span class="badge">cr√©ditos</span>
    </div>
    <button class="btnGhost" onclick="resetFlow()">‚Ü© Reiniciar</button>
  </div>

  <div class="hero">
    <div class="card">
      <h1 class="title">Comprar cr√©ditos</h1>
      <p class="subtitle">
        Selecione um pacote, escolha a indica√ß√£o (de quem voc√™ veio) e finalize via <b>Pix</b>.
        Depois, confirme o pagamento.
      </p>

      <div class="miniRow">
        <div class="mini">Total atual: <b id="miniTotal" class="red">R$ 0,00</b></div>
        <div class="mini">Pacote: <b id="miniPack">‚Äî</b></div>
        <div class="mini">Indica√ß√£o: <b id="miniRef">‚Äî</b></div>
        <div class="mini">C√≥digo: <b id="miniCode" class="red">‚Äî</b></div>
      </div>
    </div>

    <div class="card">
      <p class="subtitle" style="margin:0;">
        * GitHub Pages n√£o tem banco de dados. Para controle, a confirma√ß√£o abre seu <b>WhatsApp</b>
        j√° com a mensagem preenchida com: <b>nome</b>, <b>WhatsApp</b>, <b>cr√©ditos</b>, <b>valor</b>, <b>indica√ß√£o</b> e <b>c√≥digo</b>.
      </p>
      <div class="warn">Dica: abra com <b>?ref=JOAO01</b> (ex: <b>.../?ref=JOAO01</b>) para sugerir a indica√ß√£o automaticamente.</div>
    </div>
  </div>

  <div class="stepsCard">
    <div class="stepHeader">
      <div class="stepTitle">
        <small id="stepSmall">ETAPA 1 DE 4</small>
        <b id="stepBig">Escolher cr√©ditos</b>
        <span id="stepSub">Selecione o pacote de cr√©ditos.</span>
      </div>

      <div class="progress">
        <span class="dot active" id="dot1"></span><span class="line" id="line1"></span>
        <span class="dot" id="dot2"></span><span class="line" id="line2"></span>
        <span class="dot" id="dot3"></span><span class="line" id="line3"></span>
        <span class="dot" id="dot4"></span>

        <span class="stepLabel active" id="lbl1">Cr√©ditos</span>
        <span class="stepLabel" id="lbl2">Indica√ß√£o</span>
        <span class="stepLabel" id="lbl3">Pix</span>
        <span class="stepLabel" id="lbl4">Confirmar</span>
      </div>
    </div>

    <!-- STEP 1 -->
    <section id="step1">
      <div class="grid2">
        <div class="box">
          <div class="boxTitle">Selecione um pacote</div>

          <div class="selectWrap">
            <select id="packageSelect">
              <option value="-1">Selecione um pacote...</option>
            </select>

            <div class="packageDetails" id="packageDetails" style="display:none;">
              <div class="k">Voc√™ selecionou:</div>
              <div class="v" id="pkgTextUI">‚Äî</div>
              <div class="k" style="margin-top:8px;">Total de cr√©ditos:</div>
              <div class="v" id="pkgTotalUI">‚Äî</div>
              <div class="price" id="pkgPriceUI">‚Äî</div>
            </div>

            <div class="selectHint">
              Toque no seletor acima e escolha o plano.
            </div>
          </div>

          <div class="actions">
            <button class="btn" type="button" onclick="goStep(2)">Continuar ‚Üí</button>
          </div>
          <div class="warn">Voc√™ precisa escolher um pacote para continuar.</div>
        </div>

        <div class="box">
          <div class="boxTitle">Resumo</div>
          <div class="row"><span>Pacote</span><strong id="sumPack1">‚Äî</strong></div>
          <div class="row"><span>Total</span><strong class="total" id="sumTotal1">R$ 0,00</strong></div>
          <div class="row"><span>Indica√ß√£o</span><strong id="sumRef1">‚Äî</strong></div>
          <div class="row"><span>C√≥digo</span><strong id="sumCode1" class="mono">‚Äî</strong></div>
        </div>
      </div>
    </section>

    <!-- STEP 2 -->
    <section id="step2" style="display:none;">
      <div class="grid2">
        <div class="box">
          <div class="boxTitle">Dados + Indica√ß√£o</div>

          <div class="inputs">
            <input id="buyerName" placeholder="Seu nome" />
            <input id="buyerWhats" placeholder="Seu WhatsApp" />
          </div>

          <div style="margin-top:10px;">
            <select id="refSelect"></select>
            <div class="warn">Se n√£o tiver na lista, selecione ‚ÄúOutro‚Äù e escreva.</div>
            <input id="refOther" placeholder="Digite a indica√ß√£o (ex: JOAO01)" style="margin-top:10px; display:none;" />
          </div>

          <div class="actions">
            <button class="btn2" type="button" onclick="goStep(1)">‚Üê Voltar</button>
            <button class="btn" type="button" onclick="goStep(3)">Ir para Pix ‚Üí</button>
          </div>
        </div>

        <div class="box">
          <div class="boxTitle">Revis√£o</div>
          <div class="row"><span>Pacote</span><strong id="sumPack2">‚Äî</strong></div>
          <div class="row"><span>Total</span><strong class="total" id="sumTotal2">R$ 0,00</strong></div>
          <div class="row"><span>Indica√ß√£o</span><strong id="sumRef2">‚Äî</strong></div>
          <div class="row"><span>C√≥digo</span><strong id="sumCode2" class="mono">‚Äî</strong></div>
        </div>
      </div>
    </section>

    <!-- STEP 3 -->
    <section id="step3" style="display:none;">
      <div class="grid2">
        <div class="box">
          <div class="boxTitle">Pagamento via Pix</div>

          <div class="pixBox">
            <div>
              <div style="font-size:12px;color:rgba(255,255,255,.65);letter-spacing:.08em;text-transform:uppercase">Chave Pix</div>
              <div class="pixKey" id="pixKeyUI">SUA_CHAVE_PIX</div>
            </div>
            <button class="copyBtn" type="button" onclick="copyPix()">Copiar Pix</button>
          </div>

          <div class="pixBox">
            <div>
              <div style="font-size:12px;color:rgba(255,255,255,.65);letter-spacing:.08em;text-transform:uppercase">C√≥digo da compra</div>
              <div class="pixKey mono" id="purchaseCodeUI">‚Äî</div>
            </div>
            <button class="copyBtn" type="button" onclick="copyCode()">Copiar c√≥digo</button>
          </div>

          <div class="box" style="margin-top:14px;">
            <div class="boxTitle">Seu pedido</div>
            <div class="row"><span>Pacote</span><strong id="sumPack3">‚Äî</strong></div>
            <div class="row"><span>Total</span><strong class="total" id="sumTotal3">R$ 0,00</strong></div>
            <div class="row"><span>Indica√ß√£o</span><strong id="sumRef3">‚Äî</strong></div>
            <div class="row"><span>C√≥digo</span><strong id="sumCode3" class="mono">‚Äî</strong></div>
          </div>

          <div class="actions">
            <button class="btn2" type="button" onclick="goStep(2)">‚Üê Voltar</button>
            <button class="btn" type="button" onclick="goStep(4)">J√° paguei ‚Üí</button>
          </div>

          <div class="warn">
            Fa√ßa o Pix e guarde seu <b>c√≥digo</b>. Em seguida clique em <b>‚ÄúJ√° paguei‚Äù</b>.
          </div>
        </div>

        <div class="box">
          <div class="boxTitle">Pr√©via da mensagem do WhatsApp</div>
          <div class="row"><span>Nome</span><strong id="tgName">‚Äî</strong></div>
          <div class="row"><span>WhatsApp</span><strong id="tgWhats">‚Äî</strong></div>
          <div class="row"><span>Pacote</span><strong id="tgPack">‚Äî</strong></div>
          <div class="row"><span>Valor</span><strong id="tgTotal">‚Äî</strong></div>
          <div class="row"><span>Indica√ß√£o</span><strong id="tgRef">‚Äî</strong></div>
          <div class="row"><span>C√≥digo</span><strong id="tgCode" class="mono">‚Äî</strong></div>
        </div>
      </div>
    </section>

    <!-- STEP 4 -->
    <section id="step4" style="display:none;">
      <div class="grid2">
        <div class="box">
          <div class="boxTitle">Confirma√ß√£o</div>
          <p class="bigMsg">
            Ao clicar, vai abrir o WhatsApp em:
            <b class="mono" id="whatsNumberUI">‚Äî</b>
          </p>

          <div class="actions" style="margin-top:12px;">
            <button class="btn2" type="button" onclick="goStep(3)">‚Üê Voltar</button>
            <button class="btn" type="button" onclick="confirmPayment()">Eu fiz o pagamento</button>
          </div>

          <div class="warn">
            O site vai abrir o WhatsApp j√° com a mensagem de compra preenchida.
          </div>
        </div>

        <div class="box">
          <div class="boxTitle">Resumo final</div>
          <div class="row"><span>Nome</span><strong id="finalName">‚Äî</strong></div>
          <div class="row"><span>WhatsApp</span><strong id="finalWhats">‚Äî</strong></div>
          <div class="row"><span>Pacote</span><strong id="finalPack">‚Äî</strong></div>
          <div class="row"><span>Total</span><strong id="finalTotal" class="total">‚Äî</strong></div>
          <div class="row"><span>Indica√ß√£o</span><strong id="finalRef">‚Äî</strong></div>
          <div class="row"><span>C√≥digo</span><strong id="finalCode" class="mono">‚Äî</strong></div>
        </div>
      </div>
    </section>

  </div>
</div>

<div class="toast" id="toast">Copiado!</div>

<script>
  // =======================
  // CONFIGURE AQUI
  // =======================
  const PIX_KEY = "48998134994";          // <= TROQUE
  const WHATSAPP_NUMBER = "554891366632"; // ‚úÖ SEU N√öMERO (s√≥ n√∫meros)

  // (opcional) lista de pessoas/c√≥digos que podem indicar
  const INDICADORES = [
    "GUTO",
    "TKZ Community"
  ];

  // =======================
  // PACOTES (DA SUA TABELA)
  // =======================
  const PACKAGES = [
    { base: 10,  bonus: 0,   price: 3.00 },
    { base: 20,  bonus: 10,  price: 6.00 },
    { base: 30,  bonus: 15,  price: 9.00 },
    { base: 40,  bonus: 20,  price: 12.00 },
    { base: 50,  bonus: 30,  price: 14.90 },
    { base: 100, bonus: 50,  price: 19.90 },
    { base: 150, bonus: 75,  price: 29.90 },
    { base: 200, bonus: 100, price: 34.90 },
    { base: 300, bonus: 150, price: 49.90 },
    { base: 500, bonus: 250, price: 79.90 },
    { base: 1000,bonus: 300, price: 109.90 },
    { base: 1500,bonus: 450, price: 154.90 },
    { base: 2000,bonus: 600, price: 199.90 },
    { base: 5000,bonus: 500, price: 239.90 },
  ];

  // =======================
  // STATE
  // =======================
  const qs = new URLSearchParams(location.search);
  const refFromUrl = (qs.get("ref") || "").trim();
  let selectedIndex = -1;
  let purchaseCode = "";

  // =======================
  // HELPERS
  // =======================
  const brl = (n) => n.toLocaleString("pt-BR", { style:"currency", currency:"BRL" });

  function pkgLabel(p){
    const totalCredits = p.base + p.bonus;
    if(p.bonus > 0) return `${p.base} + ${p.bonus} (b√¥nus) = ${totalCredits} cr√©ditos`;
    return `${p.base} cr√©ditos`;
  }

  function selectedPkg(){
    return selectedIndex >= 0 ? PACKAGES[selectedIndex] : null;
  }

  function generatePurchaseCode(){
    const d = new Date();
    const date =
      String(d.getDate()).padStart(2,"0") +
      String(d.getMonth()+1).padStart(2,"0") +
      String(d.getFullYear()).slice(-2);

    const rand = Math.random().toString(36).substring(2,7).toUpperCase();
    return `AVE-${date}-${rand}`;
  }

  function setProgress(step){
    const dot1 = document.getElementById("dot1");
    const dot2 = document.getElementById("dot2");
    const dot3 = document.getElementById("dot3");
    const dot4 = document.getElementById("dot4");
    const line1 = document.getElementById("line1");
    const line2 = document.getElementById("line2");
    const line3 = document.getElementById("line3");
    const lbl1 = document.getElementById("lbl1");
    const lbl2 = document.getElementById("lbl2");
    const lbl3 = document.getElementById("lbl3");
    const lbl4 = document.getElementById("lbl4");

    [dot1,dot2,dot3,dot4].forEach(d=>d.classList.remove("active"));
    [line1,line2,line3].forEach(l=>l.classList.remove("active"));
    [lbl1,lbl2,lbl3,lbl4].forEach(l=>l.classList.remove("active"));

    if(step===1){
      dot1.classList.add("active");
      lbl1.classList.add("active");
      document.getElementById("stepSmall").textContent = "ETAPA 1 DE 4";
      document.getElementById("stepBig").textContent = "Escolher cr√©ditos";
      document.getElementById("stepSub").textContent = "Selecione o pacote de cr√©ditos.";
    }
    if(step===2){
      dot1.classList.add("active"); dot2.classList.add("active");
      line1.classList.add("active");
      lbl2.classList.add("active");
      document.getElementById("stepSmall").textContent = "ETAPA 2 DE 4";
      document.getElementById("stepBig").textContent = "Indica√ß√£o";
      document.getElementById("stepSub").textContent = "Informe seus dados e selecione de quem veio.";
    }
    if(step===3){
      dot1.classList.add("active"); dot2.classList.add("active"); dot3.classList.add("active");
      line1.classList.add("active"); line2.classList.add("active");
      lbl3.classList.add("active");
      document.getElementById("stepSmall").textContent = "ETAPA 3 DE 4";
      document.getElementById("stepBig").textContent = "Pix + C√≥digo";
      document.getElementById("stepSub").textContent = "Copie o Pix e o c√≥digo da compra.";
    }
    if(step===4){
      dot1.classList.add("active"); dot2.classList.add("active"); dot3.classList.add("active"); dot4.classList.add("active");
      line1.classList.add("active"); line2.classList.add("active"); line3.classList.add("active");
      lbl4.classList.add("active");
      document.getElementById("stepSmall").textContent = "ETAPA 4 DE 4";
      document.getElementById("stepBig").textContent = "Confirmar pagamento";
      document.getElementById("stepSub").textContent = "Clique em ‚ÄúEu fiz o pagamento‚Äù para abrir o WhatsApp com a mensagem pronta.";
    }
  }

  function getRefFinal(){
    const sel = document.getElementById("refSelect").value;
    if(sel === "__other__"){
      return (document.getElementById("refOther").value || "").trim() || "direto";
    }
    return (sel || "direto").trim();
  }

  function syncSummary(){
    const p = selectedPkg();
    const ref = getRefFinal();

    const codeTxt = purchaseCode || "‚Äî";
    document.getElementById("miniCode").textContent = codeTxt;
    document.getElementById("sumCode1").textContent = codeTxt;
    document.getElementById("sumCode2").textContent = codeTxt;
    document.getElementById("sumCode3").textContent = codeTxt;
    document.getElementById("purchaseCodeUI").textContent = codeTxt;

    document.getElementById("miniRef").textContent = ref;
    document.getElementById("sumRef1").textContent = ref;
    document.getElementById("sumRef2").textContent = ref;
    document.getElementById("sumRef3").textContent = ref;

    const details = document.getElementById("packageDetails");
    const pkgTextUI = document.getElementById("pkgTextUI");
    const pkgTotalUI = document.getElementById("pkgTotalUI");
    const pkgPriceUI = document.getElementById("pkgPriceUI");

    if(!p){
      details.style.display = "none";
      pkgTextUI.textContent = "‚Äî";
      pkgTotalUI.textContent = "‚Äî";
      pkgPriceUI.textContent = "‚Äî";

      document.getElementById("miniTotal").textContent = brl(0);
      document.getElementById("miniPack").textContent = "‚Äî";
      document.getElementById("sumPack1").textContent = "‚Äî";
      document.getElementById("sumPack2").textContent = "‚Äî";
      document.getElementById("sumPack3").textContent = "‚Äî";
      document.getElementById("sumTotal1").textContent = brl(0);
      document.getElementById("sumTotal2").textContent = brl(0);
      document.getElementById("sumTotal3").textContent = brl(0);
    } else {
      details.style.display = "block";
      const totalCredits = p.base + p.bonus;
      const packText = pkgLabel(p);

      pkgTextUI.textContent = packText;
      pkgTotalUI.textContent = `${totalCredits} cr√©ditos`;
      pkgPriceUI.textContent = brl(p.price);

      document.getElementById("miniPack").textContent = packText;
      document.getElementById("sumPack1").textContent = packText;
      document.getElementById("sumPack2").textContent = packText;
      document.getElementById("sumPack3").textContent = packText;

      document.getElementById("miniTotal").textContent = brl(p.price);
      document.getElementById("sumTotal1").textContent = brl(p.price);
      document.getElementById("sumTotal2").textContent = brl(p.price);
      document.getElementById("sumTotal3").textContent = brl(p.price);
    }

    const name = (document.getElementById("buyerName").value || "").trim();
    const whats = (document.getElementById("buyerWhats").value || "").trim();

    document.getElementById("tgName").textContent = name || "‚Äî";
    document.getElementById("tgWhats").textContent = whats || "‚Äî";
    document.getElementById("tgPack").textContent = p ? pkgLabel(p) : "‚Äî";
    document.getElementById("tgTotal").textContent = p ? brl(p.price) : "‚Äî";
    document.getElementById("tgRef").textContent = ref;
    document.getElementById("tgCode").textContent = purchaseCode || "‚Äî";

    document.getElementById("finalName").textContent = name || "‚Äî";
    document.getElementById("finalWhats").textContent = whats || "‚Äî";
    document.getElementById("finalPack").textContent = p ? pkgLabel(p) : "‚Äî";
    document.getElementById("finalTotal").textContent = p ? brl(p.price) : "‚Äî";
    document.getElementById("finalRef").textContent = ref;
    document.getElementById("finalCode").textContent = purchaseCode || "‚Äî";
  }

  function goStep(step){
    if(step === 2 && selectedIndex < 0){
      alert("Selecione um pacote de cr√©ditos para continuar.");
      return;
    }

    if(step === 3){
      const name = (document.getElementById("buyerName").value || "").trim();
      const whats = (document.getElementById("buyerWhats").value || "").trim();
      if(!name || !whats){
        alert("Preencha seu nome e WhatsApp para continuar.");
        return;
      }
      if(!purchaseCode){
        purchaseCode = generatePurchaseCode();
      }
    }

    if(step === 4 && !purchaseCode){
      alert("Primeiro gere o c√≥digo na etapa do Pix.");
      return;
    }

    document.getElementById("step1").style.display = (step===1) ? "block" : "none";
    document.getElementById("step2").style.display = (step===2) ? "block" : "none";
    document.getElementById("step3").style.display = (step===3) ? "block" : "none";
    document.getElementById("step4").style.display = (step===4) ? "block" : "none";

    setProgress(step);
    syncSummary();
    window.scrollTo({top:0, behavior:"smooth"});
  }

  function renderPackagesSelect(){
    const sel = document.getElementById("packageSelect");
    sel.innerHTML = `<option value="-1">Selecione um pacote...</option>`;

    PACKAGES.forEach((p, idx) => {
      const totalCredits = p.base + p.bonus;
      const label = (p.bonus > 0)
        ? `${p.base} + ${p.bonus} b√¥nus (${totalCredits}) ‚Äî ${brl(p.price)}`
        : `${p.base} cr√©ditos ‚Äî ${brl(p.price)}`;

      const o = document.createElement("option");
      o.value = String(idx);
      o.textContent = label;
      sel.appendChild(o);
    });

    sel.addEventListener("change", () => {
      const v = parseInt(sel.value, 10);
      selectedIndex = Number.isFinite(v) ? v : -1;
      if(selectedIndex < 0) selectedIndex = -1;
      syncSummary();
    });
  }

  function showToast(text){
    const t = document.getElementById("toast");
    t.textContent = text || "Copiado!";
    t.style.display = "block";
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(()=> t.style.display="none", 1400);
  }

  async function copyText(txt, okMsg){
    try{
      await navigator.clipboard.writeText(txt);
      showToast(okMsg || "Copiado!");
    }catch(e){
      const temp = document.createElement("textarea");
      temp.value = txt;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      temp.remove();
      showToast(okMsg || "Copiado!");
    }
  }

  function copyPix(){ copyText(PIX_KEY, "Chave Pix copiada!"); }

  function copyCode(){
    if(!purchaseCode){
      alert("Preencha seu nome e WhatsApp para gerar o c√≥digo da compra.");
      return;
    }
    copyText(purchaseCode, "C√≥digo copiado! Fa√ßa o Pix e depois confirme.");
  }

  // ‚úÖ FUN√á√ÉO CORRIGIDA (sem ‚ÄúP√°gina: ...‚Äù e sem erro de crase)
  function confirmPayment(){
    if(!purchaseCode){
      alert("Primeiro gere o c√≥digo na etapa do Pix.");
      return;
    }

    const p = selectedPkg();
    const name = (document.getElementById("buyerName").value || "").trim();
    const buyerWhats = (document.getElementById("buyerWhats").value || "").trim();
    const ref = getRefFinal();
    const when = new Date().toLocaleString("pt-BR");

    const msg =
`‚úÖ CONFIRMA√á√ÉO DE PAGAMENTO ‚Äî AVECTRUM

üë§ Nome: ${name || "‚Äî"}
üì± WhatsApp do cliente: ${buyerWhats || "‚Äî"}

üßæ C√≥digo: ${purchaseCode || "‚Äî"}
üéÅ Pacote: ${p ? pkgLabel(p) : "‚Äî"}
üí∞ Total: ${p ? brl(p.price) : "‚Äî"}

üß∑ Indica√ß√£o: ${ref || "direto"}
üïí Quando: ${when}`.trim();

    const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
    window.open(url, "_blank");
  }

  function resetFlow(){
    selectedIndex = -1;
    purchaseCode = "";
    document.getElementById("buyerName").value = "";
    document.getElementById("buyerWhats").value = "";

    const pkgSel = document.getElementById("packageSelect");
    pkgSel.value = "-1";

    const sel = document.getElementById("refSelect");
    sel.value = "direto";
    document.getElementById("refOther").style.display = "none";
    document.getElementById("refOther").value = "";

    goStep(1);
    syncSummary();
  }

  function setupIndicacao(){
    const sel = document.getElementById("refSelect");
    sel.innerHTML = "";

    const opts = [...new Set(["direto", ...INDICADORES.filter(Boolean)])];
    if(refFromUrl) opts.unshift(refFromUrl);
    const final = [...new Set(opts)];

    final.forEach(v=>{
      const o = document.createElement("option");
      o.value = v;
      o.textContent = (v === "direto") ? "Direto (sem indica√ß√£o)" : v;
      sel.appendChild(o);
    });

    const other = document.createElement("option");
    other.value = "__other__";
    other.textContent = "Outro (digitar)";
    sel.appendChild(other);

    sel.value = refFromUrl ? refFromUrl : "direto";

    document.getElementById("miniRef").textContent = sel.value || "‚Äî";
    document.getElementById("sumRef1").textContent = sel.value || "‚Äî";

    sel.addEventListener("change", ()=>{
      const show = sel.value === "__other__";
      const inp = document.getElementById("refOther");
      inp.style.display = show ? "block" : "none";
      syncSummary();
    });

    document.getElementById("refOther").addEventListener("input", syncSummary);
    document.getElementById("buyerName").addEventListener("input", syncSummary);
    document.getElementById("buyerWhats").addEventListener("input", syncSummary);
  }

  // INIT
  document.getElementById("pixKeyUI").textContent = PIX_KEY;
  document.getElementById("whatsNumberUI").textContent = WHATSAPP_NUMBER;

  renderPackagesSelect();
  setupIndicacao();
  setProgress(1);
  syncSummary();
</script>

</body>
</html>
